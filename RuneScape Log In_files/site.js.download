/*! (c) 2018 Jagex Limited */

(function(){CM.global={listenForm:function(){return $("*[data-abide]").on("forminvalid.zf.abide",function(){return $("#l-vista__container").addClass("l-vista__container--style-attention")})},redirectUser:function(e){return document.location=e},sendGaEvents:function(e,n,a,t){var i;return null==a&&(a=!1),null==t&&(t=!1),i="gaEvent",t&&(i="gaEventNI"),window.dataLayer=window.dataLayer||[],e.forEach(function(e){return window.dataLayer.push({event:i,gaEventCat:n,gaEventAct:e,eventCallback:function(){if(a)return a()}})})}}}).call(this),function(){CM.accountCreation={url:null,displayNameValid:!1,cachedNameSuggestions:null,displayNameField:null,displayNameLabel:null,emailTakenError:!1,initialise:function(){return CM.accountCreation.url=accountCreationUrl||"https://secure.runescape.com/m=account-creation/",$("#facebooklogin").length&&RS.facebook.loadFacebookAPI(RS.facebook.setUpEvents),$(document).ready((e=this,function(){if(e.listenForm(),e.validateCaptcha(),e.tabSwitch(),e.handleTracking(),CM.accountCreation.displayNameField=$("#display-name"),CM.accountCreation.displayNameField.length)return e.nameSuggestions()}));var e},validateCaptcha:function(){return $("#create-email-form").on("submit",function(e){if($("#google-recaptcha").length&&"undefined"!=typeof grecaptcha)return""===grecaptcha.getResponse()?(e.preventDefault(),$("#google-recaptcha-error").addClass("c-google-recaptcha-error--visibility-show")):$("#google-recaptcha-error").removeClass("c-google-recaptcha-error--visibility-show")})},listenForm:function(){var e;return e=$("#create-email-form"),CM.accountCreation.displayNameLabel=$("#display-name-label"),e.on("forminvalid.zf.abide",function(){return $("#l-vista__container").addClass("l-vista__container--style-attention")}),$("*[data-show-password]").on("click",function(){var e,n;return n=$(this).data("show-password"),e=$("#"+n),$(this).is(":checked")?e.attr("type","text"):e.attr("type","password")}),e.on("submit",function(e){if(!CM.accountCreation.displayNameValid)return e.preventDefault(),CM.accountCreation.validateName})},nameSuggestions:function(){return""!==CM.accountCreation.displayNameField.val()&&CM.accountCreation.validateName(),CM.accountCreation.displayNameField.on("change",function(){return CM.accountCreation.displayNameValid=!1,CM.accountCreation.hideNameSuggestions(),CM.accountCreation.validateName()}),$("#display-name-alts-more").on("click",function(){return CM.accountCreation.cachedNameSuggestions=null,CM.accountCreation.validateName()})},validateName:function(){var e,n;return CM.accountCreation.displayNameLabel.removeClass("a-label--checker-checking-done"),CM.accountCreation.displayNameLabel.addClass("a-label--checker-checking"),(e=CM.accountCreation.displayNameField.val())||""!==e?((n={}).displayname=encodeURIComponent(e),null!==CM.accountCreation.cachedNameSuggestions&&void 0!==CM.accountCreation.cachedNameSuggestions&&0<CM.accountCreation.cachedNameSuggestions.length&&(n.noNameSuggestions=!0),$.ajax({type:"POST",cache:!1,url:CM.accountCreation.url+"check_displayname.ajax",data:n,success:function(e){return CM.accountCreation.handleResults(e)},dataType:"json"})):(CM.accountCreation.displayNameValid=!1,CM.accountCreation.displayNameLabel.removeClass("a-label--checker-checking"))},handleResults:function(e){var n;return void 0!==e.displayNameIsValid&&"false"===e.displayNameIsValid?void 0!==CM.accountCreation.cachedNameSuggestions&&CM.accountCreation.cachedNameSuggestions&&0<CM.accountCreation.cachedNameSuggestions.length?CM.accountCreation.showNameSuggestions(CM.accountCreation.cachedNameSuggestions):void 0!==e.nameSuggestions&&e.nameSuggestions&&0<e.nameSuggestions.length?(n=e.nameSuggestions,CM.accountCreation.showNameSuggestions(n),CM.accountCreation.cachedNameSuggestions=n):(CM.accountCreation.hideNameSuggestions(),CM.accountCreation.displayNameValid=!0,CM.accountCreation.displayNameLabel.removeClass("a-label--checker-checking")):(CM.accountCreation.hideNameSuggestions(),CM.accountCreation.displayNameValid=!0,CM.accountCreation.displayNameLabel.addClass("a-label--checker-checking-done"),CM.accountCreation.displayNameField.removeClass("is-invalid-input"))},showNameSuggestions:function(e){var n,a;return CM.accountCreation.displayNameField.addClass("is-invalid-input"),CM.accountCreation.displayNameLabel.removeClass("a-label--checker-checking"),n=$("#display-name-alts-inner"),a="",$("#display-name-alts").addClass("display-name-alts--show"),$.each(e,function(e,n){return a+="<span data-index='"+e+"' class='display-name-alts__name' data-name-alts-suggestion>"+n+"</span>"}),n.html(a),$("*[data-name-alts-suggestion]").on("click",function(){var e;return CM.accountCreation.hideNameSuggestions(),e=$(this).text().replace(/\u00a0/g," "),CM.accountCreation.displayNameField.val(e),CM.accountCreation.displayNameValid=!0})},hideNameSuggestions:function(){return $("#display-name-alts").removeClass("display-name-alts--show"),CM.accountCreation.displayNameField.removeClass("is-invalid-input"),CM.accountCreation.displayNameLabel.one("webkitAnimationEnd msAnimationEnd animationend",function(){return CM.accountCreation.displayNameLabel.removeClass("a-label--checker-checking a-label--checker-checking-done")})},tabSwitch:function(){return $("#welcome-tabs").on("change.zf.tabs",function(e,n){if(0<=n.find("a").attr("id").indexOf("welcomeback"))return dataLayer.push({event:"routeChange",routePath:"/m=account-creation/welcome_back"})})},handleTracking:function(){var e;if(CM.accountCreation.emailTakenError=emailTakenError||!1,CM.accountCreation.emailTakenError)return e=["Account email already taken"],CM.global.sendGaEvents(e,"account-creation",!1,!0)}}}.call(this),function(){CM.dob={dobSubmitted:function(){return""===redirectStr?this.initialise():CM.global.sendGaEvents(gaEvents,"DOB",function(){return CM.global.redirectUser(redirectStr)})},initialise:function(){return $(document).ready(function(){return"undefined"!=typeof gaEvents&&null!==gaEvents&&CM.global.sendGaEvents(gaEvents,"DOB"),CM.global.listenForm()})}}}.call(this),function(){CM.emailRegister={initialise:function(){return CM.global.listenForm()}}}.call(this),function(){CM.video={setVideoSrc:function(e,n){var a;return(a=document.createElement("source")).setAttribute("src",n),a.setAttribute("type",e),a},init:function(){return $(document).ready(function(){var t,n,e;return e=$("*[data-video]"),Modernizr.video&&Modernizr.objectfit&&Foundation.MediaQuery.atLeast("medium")?Modernizr.on("videoautoplay",function(a){return e.each(function(){var e,n;return n=(e=$(this))[0],a?(e.attr("muted","muted"),e.attr("loop","loop"),e.attr("playsinline","playsinline"),""!==e.data("video-webm")&&e.append(CM.video.setVideoSrc("video/webm",e.data("video-webm"))),""!==e.data("video-mp4")&&e.append(CM.video.setVideoSrc("video/mp4",e.data("video-mp4"))),e.addClass("a-bg-video--visibility-show"),n.load(),n.play()):e.remove(),t(n)})}):e.remove(),t=function(e){return $(document).on("visibilitychange",function(){return n(e)})},n=function(e){return document.hidden&&!e.paused?e.pause():!document.hidden&&e.paused?e.play():void 0}})}}}.call(this),function(){RS.billingPackage={getPrice:function(t){var e,i,n,o;return RS.constant.url.secure,n=t.dataset.packageString,i=t.dataset.packId,e=t.dataset.billingStore+n,o=t.dataset.packageGroup,$.ajax({url:e,timeout:3e3,dataType:"json",success:function(e){var n,a;return e.results[i]?(a=e.results[i],n=o+a.packageGroup,$(t).find("[data-package-price]").text(a.localisedPrice),$(t).find("[data-package-btn]").attr({alt:a.localisedName,title:a.localisedName,href:n}),a.strikePrice&&$(t).find("[data-package-strike]").text(a.strikePrice),a.localisedSavingPrice&&($(t).find("[data-package-saving]").removeClass("c-package__saving--hidden"),$(t).find("[data-package-saving-price]").text(a.localisedSavingPrice)),$(t).find("[data-package-btn]").removeClass("a-button--hidden")):($(t).addClass("c-package--hidden"),$(t).next("[data-package-fallback]").removeClass("c-package--hidden"))},error:function(){return $(t).addClass("c-package--hidden"),$(t).next("[data-package-fallback]").removeClass("c-package--hidden")}})},initialise:function(){return $(document).ready(function(){var e,n,a,t,i;for(i=[],e=0,a=(t=$("*[data-package]")).length;e<a;e++)n=t[e],i.push(RS.billingPackage.getPrice(n));return i})}}}.call(this),function(){RS.emailSignUp={initialise:function(){return $(document).ready(function(){return $("*[data-email-signup]").on("forminvalid.zf.abide",function(){return $(this).addClass("c-email-signup__form--style-attention")}),$("*[data-email-signup]").on("formvalid.zf.abide",function(){var e,n,a;return e=$(this).data("email-signup"),(n=new Date).setFullYear(n.getFullYear()+10),a="; expires="+n.toUTCString(),document.cookie=e+"= 1"+a+"; path=/"})})}}}.call(this),function(){RS.facebook={loadFacebookAPI:function(e){if("undefined"==typeof FB||null===FB)return 0===$("#fb-root").length&&$("body").prepend('<div id="fb-root"></div>'),window.fbAsyncInit=function(){if(FB.init({appId:PAGEGLOBALS.FB.appId,status:!1,cookie:!0,xfbml:!0,version:PAGEGLOBALS.FB.apiVersion,oauth:!0}),e)return e()},function(e,n){var a,t,i,o;if(i="",t="facebook-jssdk",o=e.getElementsByTagName("script")[0],a="",!e.getElementById(t))return(i=e.createElement("script")).id=t,i.async=!0,i.src="//connect.facebook.net/en_US/sdk"+a+".js",o.parentNode.insertBefore(i,o)}(document)},fbLoginRedirect:function(a,t){var e,i,o,r;return i=PAGEGLOBALS.FB.fbURL,e=PAGEGLOBALS.FB.checkLoginURL,r=PAGEGLOBALS.FB.loginURL,o=500,$.getJSON(e+"?json=?",{tips:0,token:FB.getAuthResponse().accessToken,expiry:FB.getAuthResponse().expiresIn,signed:FB.getAuthResponse().signedRequest},function(e){var n;if(n="",e.sso<0)return window.alert("There was a problem verifying your login. Please try again."),!1;if(1<e.sso.length){if(!(-1<e.sna))return null==t&&(t=""),n=r+"?key="+e.sso+"?"+a,"_parent"===t?window.parent.location=n:"_top"===t?window.top.location=n:"_blank"===t?window.open(n,"_blank"):window.location=n,!0;n=i+"?key="+e.sso+"&tps=0&"+a,"_parent"===t&&(window.parent.location=n),o=620}else n=i+"?"+a,"_parent"===t&&(window.parent.location=n);return"_parent"!==t?$.fancybox({href:n,type:"iframe",width:462,height:o,autoSize:!1,wrapCSS:"loginFancyBoxFB"}):void 0}),!1},fbButtonClickHandler:function(e,n){var a;return a=e||PAGEGLOBALS.FB.queryString,"undefined"==typeof FB||null===FB||"function"!=typeof FB.getAuthResponse?window.alert("Couldn't contact Facebook. Please try again later."):null==FB.getAuthResponse()?FB.login(function(e){return e.authResponse?RS.facebook.fbLoginRedirect(a,n):window.alert("Authentication with Facebook failed. Please try again.")},{scope:PAGEGLOBALS.FB.scope}):RS.facebook.fbLoginRedirect(a,n)},setUpEvents:function(){return $("#facebooklogin").click(function(e){var n,a,t;return e.preventDefault(),n=(t=$(this)).data("redirecturl"),a=t.attr("target"),RS.facebook.fbButtonClickHandler(n,a)})}}}.call(this),function(){RS.login={initialise:function(){return RS.facebook.loadFacebookAPI(RS.facebook.setUpEvents),PAGEGLOBALS.FB.queryString=PAGEGLOBALS.FB.queryString.replace(/amp;/g,""),$("#login-form").attr("action",$("#login-form").attr("action")+window.location.hash),$(document).ready((e=this,function(){return e.validateCaptcha(),e.listenForm()}));var e},listenForm:function(){return $("#login-form").on("forminvalid.zf.abide",function(){return $("#l-vista__container").addClass("l-vista__container--style-attention")})},validateCaptcha:function(){return $("#login-form").on("submit",function(e){if($("#google-recaptcha").length&&"undefined"!=typeof grecaptcha){if(""!==grecaptcha.getResponse())return $("#google-recaptcha-error").removeClass("c-google-recaptcha-error--visibility-show");if(e.preventDefault(),$("#google-recaptcha-error").addClass("c-google-recaptcha-error--visibility-show"),""!==$("#login-username").val()&&""!==$("#login-password").val())return $(".login-error").remove()}})}}}.call(this),function(){RS.logout={initialise:function(){return setTimeout(function(){return RS.logout.redirect()},15e3)},redirect:function(){if(null!=RS.constant.url.home)return location.href=RS.constant.url.home}}}.call(this),function(){RS.menu={initialise:function(){return $(document).ready(function(){return RS.menu.nav(),$(window).resize(function(){return RS.menu.nav()}),$("*[data-menu-toggle]").on("click",function(){return $(this).next().children("[data-menu-list]").toggleClass("c-menu__nav-list--state-open")})})},nav:function(){return $("*[data-menu-list]").removeClass("c-menu__nav-list--state-open"),$("*[data-menu]").removeClass("c-menu--style-stacked"),$("*[data-menu]").each(function(){var e,n,a;return a=(e=$(this)).width(),n=0,e.children().each(function(){if($(this).is(":visible"))return n+=Math.ceil($(this).width())}),a<n?e.addClass("c-menu--style-stacked"):e.removeClass("c-menu--style-stacked")})}}}.call(this),function(){RS.snGlobal={resize:function(){var e;if(e=$("body"),parent&&"function"==typeof parent.resizeRaggedBox)return parent.resizeRaggedBox(frameElement,e.outerHeight(!0))}},RS.snManage={initialise:function(){return RS.snGlobal.resize(),errorCode!==ERROR_UNABLE_TO_UPGRADE&&$(".sn-account-window__disassociate-link").on("click",function(e){var n,a;return e.preventDefault(),a=(n=$(this)).data("service"),$(".sn-account-window__disassociate-form--visibility-show").removeClass("sn-account-window__disassociate-form--visibility-show"),$(".sn-account-window__disassociate-link--visibility-hide").removeClass("sn-account-window__disassociate-link--visibility-hide"),$("#"+a).addClass("sn-account-window__disassociate-form--visibility-show"),n.addClass("sn-account-window__disassociate-link--visibility-hide")}),$("#facebooklogin").on("click",function(e){return e.preventDefault(),null===FB.getAuthResponse()||void 0===FB.getAuthResponse()?getWebScriptPermissions?FB.login(function(e){if(e.authResponse)return fbLoginRedirect()},{scope:getWebScriptPermissions}):FB.login(function(e){if(e.authResponse)return fbLoginRedirect()}):fbLoginRedirect()})}},RS.snNoassociation={initialise:function(){return $("#syncAccount").on("click",function(e){return e.preventDefault(),$("#landing-screen").remove(),CM.global.listenForm(),$("#l-vista").addClass("l-vista--size-narrow"),$("#errorMessageForm").remove(),$("#associateAccount").addClass("sn-integration-sync--visibility-show")})}},RS.snSetLogin={initialise:function(){return CM.global.listenForm()}}}.call(this),function(){RS.user={visited:function(){return 90,Cookies.set("global__user-visited",!0,{expires:90,domain:"runescape.com"})}}}.call(this),function(){RS.global={initialise:function(){switch(RS.global.foundation(),RS.user.visited(),null!=RS.components.billingPackage&&RS.billingPackage.initialise(),null!=RS.components.emailSignUp&&RS.emailSignUp.initialise(),null!=RS.components.menu&&RS.menu.initialise(),null!=RS.components.video&&CM.video.init(),document.getElementsByTagName("body")[0].id){case"p-create-account":return CM.accountCreation.initialise();case"p-email-register-set-address":case"p-email-register-change":return CM.emailRegister.initialise();case"p-login":return RS.login.initialise();case"p-logout":return RS.logout.initialise();case"p-sn-manage":return RS.snManage.initialise();case"p-sn-upgrade":case"p-sn-confirmreplace":case"p-sn-denied":return RS.snGlobal.resize();case"p-sn-noassociation":return RS.snNoassociation.initialise();case"p-sn-setlogin":return RS.snSetLogin.initialise();case"p-dob-submit":return CM.dob.initialise();case"p-dob-submitted":return CM.dob.initialise(),CM.dob.dobSubmitted()}},foundation:function(){return Foundation.Tabs.defaults.linkClass="c-tabs__option",Foundation.Tabs.defaults.panelClass="c-tabs__panel",Foundation.Tabs.defaults.deepLink=!0,Foundation.Tabs.defaults.updateHistory=!0,$(document).foundation()}},RS.global.initialise()}.call(this);